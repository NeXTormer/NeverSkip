name: build_for_android

on:
  push:
    tag:
      - "v*.*.*"

jobs:
  build:

    runs-on: self-hosted

    steps:
    # Setup Java environment in order to build the Android app.
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    
    # Flutter Setup
    - uses: subosito/flutter-action@v1
      with:
        channel: 'stable'
        flutter-version: '2.8.0'
    
    - run: flutter pub get
    - run: |
        echo "${{ secrets.FREDERIC_ANDROID_RELEASE_KEYSTORE }}" > android/release.keystore.asc
        gpg -d --passphrase "${{ FREDERIC_ANDROID_RELEASE_KEYSTORE_PASSPHRASE }}" --batch release.keystore.asc > android/release.keystore
